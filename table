CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE TYPE resource_type_enum AS ENUM ('Product', 'Resource', 'Asset');
CREATE TYPE recipe_template_type_enum AS ENUM ('FDA', 'Custom');
CREATE TYPE event_type_enum AS ENUM ('EconomicEvent');
CREATE TYPE action_type_enum AS ENUM ('Cite', 'Modify', 'Produce', 'Consume', 'Transfer', 'Use', 'Load', 'Unload');
CREATE TYPE role_type_enum AS ENUM ('Input', 'Output');
CREATE TYPE field_value_enum AS ENUM ('product', 'quantity', 'hasPointInTime', 'atLocation');
CREATE TYPE field_type_enum AS ENUM ('Text', 'Date', 'Number', 'Select');

--Company Table
CREATE TABLE IF NOT EXISTS agents (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name TEXT NOT NULL,
    note TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

--Products Specification Table
CREATE TABLE IF NOT EXISTS resource_specifications (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    agent_id UUID NOT NULL REFERENCES agents(id),
    name TEXT NOT NULL,
    note TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    resource_type resource_type_enum NOT NULL,
    unit_of_measure TEXT NOT NULL
);

--Products Table
CREATE TABLE IF NOT EXISTS economic_resources (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    resource_specification_id UUID NOT NULL REFERENCES resource_specifications(id),
    name TEXT NOT NULL,
    note TEXT,
    accounting_quantity INTEGER NOT NULL,
    on_hand_quantity INTEGER NOT NULL,
    tracking_identifier TEXT,
    current_location TEXT NOT NULL,
    lot TEXT,
    contained_in UUID REFERENCES economic_resources(id),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    reference_number SERIAL
);

--ProcessTemplates
CREATE TABLE IF NOT EXISTS recipe_templates (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name TEXT NOT NULL,
    recipe_template_type recipe_template_type_enum NOT NULL
);

--ProcessTemplateAccess
CREATE TABLE IF NOT EXISTS recipe_templates_access (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    agent_id UUID NOT NULL REFERENCES agents(id),
    recipe_template_id UUID NOT NULL REFERENCES recipe_templates(id)
);

--ProcessFlowTemplates
CREATE TABLE IF NOT EXISTS recipe_flow_templates (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    recipe_template_id UUID NOT NULL REFERENCES recipe_templates(id),
    event_type event_type_enum NOT NULL,
    role_type role_type_enum NOT NULL
    action action_type_enum NOT NULL
);

--ProcessFlowTemplateDataFields
CREATE TABLE IF NOT EXISTS recipe_flow_template_data_fields (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    recipe_flow_template_id UUID NOT NULL REFERENCES recipe_flow_templates(id),
    field_value field_value_enum NOT NULL,
    field TEXT NOT NULL,
    field_type field_type_enum NOT NULL,
    note TEXT,
    required BOOLEAN NOT NULL,
    query TEXT,
    default_value TEXT  
);

--Process Map
CREATE TABLE IF NOT EXISTS recipes (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    agent_id UUID NOT NULL REFERENCES agents(id),
    name TEXT NOT NULL,
    note TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

--Process Map Products
CREATE TABLE IF NOT EXISTS recipe_resources (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    recipe_id UUID NOT NULL REFERENCES recipes(id),
    resource_specification_id UUID NOT NULL REFERENCES resource_specifications(id),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

--Process
CREATE TABLE IF NOT EXISTS processes (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    recipe_template_id UUID NOT NULL REFERENCES recipe_templates(id),
    recipe_id UUID NOT NULL REFERENCES recipes(id),
    name TEXT NOT NULL,
    note TEXT,
    output_of UUID REFERENCES processes(id),
    template_id UUID NOT NULL REFERENCES recipe_templates(id),  -- Updated from templates to recipe_templates
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

--ProcessFlow
CREATE TABLE IF NOT EXISTS process_flow (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    process_id UUID NOT NULL REFERENCES processes(id),
    event_type event_type_enum NOT NULL,
    action_type action_type_enum NOT NULL,
    role role_type_enum NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

--ProcessFlowDataFields
CREATE TABLE IF NOT EXISTS process_flow_data_fields (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    process_flow_id UUID NOT NULL REFERENCES process_flow(id),
    field_value field_value_enum NOT NULL,
    field TEXT NOT NULL,
    field_type field_type_enum NOT NULL,
    note TEXT,
    required BOOLEAN NOT NULL,
    query TEXT,
    default_value TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

--ProcessEvents
CREATE TABLE IF NOT EXISTS process_events (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    process_flow_data_field_id UUID NOT NULL REFERENCES process_flow_data_fields(id),
    query_value UUID,
    value TEXT NOT NULL,
    reference_number SERIAL,
    provider UUID NOT NULL REFERENCES agents(id), 
    receiver UUID NOT NULL REFERENCES agents(id), 
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
